## Overall Process Documentation - AWS Step Function Workflow 

  

### Introduction 

This documentation outlines the overall process of an AWS Step Function workflow that efficiently orchestrates the execution of three AWS Lambda functions. The Step Function coordinates the retrieval, processing, and storage of data in an RDS database. The primary purpose of this process is to retrieve the `run_id`, generate and process random numbers, and calculate the average value of these numbers to store them back in the database. 

  

### Architecture Overview 

The process involves the following components: 

  

1. AWS Step Function: The orchestrator that coordinates the execution of Lambda functions and manages the flow of data between them. 

  

2. AWS Lambda Functions: 

   - **Lambda Function 1 (retrieve-run-id):** Retrieves the `run_id` from the RDS database and generates input data for parallel processing. 

   - **Lambda Function 2 (generate-random-number-and-write-to-db):** Generates random numbers, adds a delay of 600 seconds, and writes the data to the RDS database. 

   - **Lambda Function 3 (aggregate-and-store-average-value-in-db):** Calculates the average value of data with the same `run_id` and stores it back in the RDS database. 

  

3. Amazon RDS Database: Stores the `run_id` and the data generated by the Lambda functions. 

  

### Step Function Workflow 

The Step Function workflow comprises the following states: 

  

#### State 1: Lambda Invoke (retrieve-run-id) 

- Purpose: Invokes the first Lambda function to retrieve the `run_id` from the RDS database and generate input data for parallel processing. 

- Input: The input for this state is provided at the start of the Step Function workflow. 

- Output: Returns a list of entries, each containing the `run_id` and an iteration number. 

- Retry: The state has retry logic for specific Lambda errors to ensure robustness. 

- Next State: Map State (Parallel processing of Lambda functions). 

  

#### State 2: Map (Parallel Processing) 

- Purpose: Processes the list of entries in parallel by invoking the second Lambda function for each entry. 

- Input: Receives the list of entries generated in the previous state. 

- Output: None (Parallel processing). 

- Lambda Function: The second Lambda function generates random numbers, adds a delay of 600 seconds, and writes the data to the RDS database. 

- Next State: Pass State (Sequential processing). 

  

#### State 3: Pass (Sequential Processing) 

- Purpose: Sequentially processes the data from the previous state. 

- Input: Receives the output from the parallel processing state. 

- Output: None (No change to the data). 

- Next State: Lambda Invoke (2). 

  

#### State 4: Lambda Invoke (aggregate-and-store-average-value-in-db) 

- Purpose: Invokes the third Lambda function to calculate the average value of data with the same `run_id` and store it back in the RDS database. 

- Input: Receives the processed data from the previous state. 

- Output: Returns the calculated average value. 

- End State: This state marks the successful completion of the Step Function workflow. 

  

### Workflow Summary 

1. The Step Function is triggered with the initial input data to start the workflow. 

2. The "Lambda Invoke (retrieve-run-id)" state retrieves the `run_id` from the RDS database and generates the input data for parallel processing. 

3. The "Map" state processes the data in parallel by invoking the second Lambda function for each entry. 

4. The "Pass" state sequentially processes the data and passes it to the next state, "Lambda Invoke (2)." 

5. In the final state, "Lambda Invoke (aggregate-and-store-average-value-in-db)," the third Lambda function calculates the average value for each `run_id` and stores it back in the RDS database. 

6. The workflow successfully completes after the execution of the third Lambda function. 

 
